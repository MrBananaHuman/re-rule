package kr.ac.kaist.mrlab.from_the_s;

import org.json.simple.JSONObject;
import org.json.simple.parser.JSONParser;
import org.json.simple.parser.ParseException;
import org.junit.Test;

import java.io.IOException;

/**
 * Created by gyuhyeon on 6/20/17.
 */
public class TestDPFactory {

    @Test
    public void testGenerate() throws ParseException {
        JSONParser jp = new JSONParser();

        JSONObject instance = (JSONObject) jp.parse("{\"sentence\":{\"phrase_dependency\":[{\"weight\":0,\"end\":1,\"key_begin\":0,\"id\":0,\"label\":\"NP_SBJ\",\"text\":\"《Sweet Dream》은\",\"head_phrase\":1,\"begin\":0,\"sub_phrase\":[],\"element\":[]},{\"weight\":0,\"end\":9,\"key_begin\":2,\"id\":1,\"label\":\"S\",\"text\":\"P#0@SBJ은 대한민국의 여성 가수 장나라의 두 번째 정규 음반이자,\",\"head_phrase\":3,\"begin\":0,\"sub_phrase\":[0],\"element\":[{\"end\":14,\"ne_type\":\"\",\"text\":\"대한민국의 여성 가수 장나라의 두 번째 정규 음반\",\"label\":\"NP\",\"begin\":5},{\"end\":17,\"ne_type\":\"\",\"text\":\"이자,\",\"label\":\"VP\",\"begin\":15}]},{\"weight\":0,\"end\":11,\"key_begin\":10,\"id\":2,\"label\":\"NP_AJT\",\"text\":\"이 음반에\",\"head_phrase\":3,\"begin\":10,\"sub_phrase\":[],\"element\":[]},{\"weight\":0,\"end\":12,\"key_begin\":12,\"id\":3,\"label\":\"S_MOD\",\"text\":\"S#1@S자, P#2@AJT에 수록된\",\"head_phrase\":4,\"begin\":0,\"sub_phrase\":[1,2],\"element\":[]},{\"weight\":0,\"end\":14,\"key_begin\":13,\"id\":4,\"label\":\"S\",\"text\":\"S#3@MODㄴ 타이틀 송이다.\",\"head_phrase\":-1,\"begin\":0,\"sub_phrase\":[3],\"element\":[{\"end\":25,\"ne_type\":\"\",\"text\":\"타이틀 송이\",\"label\":\"NP\",\"begin\":24},{\"end\":28,\"ne_type\":\"\",\"text\":\"다.\",\"label\":\"VP\",\"begin\":26}]}],\"dependency\":[{\"head\":1,\"mod\":[],\"weight\":0.716453,\"id\":0,\"text\":\"《Sweet\",\"label\":\"NP\"},{\"head\":9,\"mod\":[0],\"weight\":0.816668,\"id\":1,\"text\":\"Dream》은\",\"label\":\"NP_SBJ\"},{\"head\":4,\"mod\":[],\"weight\":0.754921,\"id\":2,\"text\":\"대한민국의\",\"label\":\"NP_MOD\"},{\"head\":4,\"mod\":[],\"weight\":0.763106,\"id\":3,\"text\":\"여성\",\"label\":\"NP\"},{\"head\":5,\"mod\":[2,3],\"weight\":0.689055,\"id\":4,\"text\":\"가수\",\"label\":\"NP\"},{\"head\":9,\"mod\":[4],\"weight\":0.743063,\"id\":5,\"text\":\"장나라의\",\"label\":\"NP_MOD\"},{\"head\":7,\"mod\":[],\"weight\":0.799762,\"id\":6,\"text\":\"두\",\"label\":\"DP\"},{\"head\":9,\"mod\":[6],\"weight\":0.0620313,\"id\":7,\"text\":\"번째\",\"label\":\"NP\"},{\"head\":9,\"mod\":[],\"weight\":0.867452,\"id\":8,\"text\":\"정규\",\"label\":\"NP\"},{\"head\":12,\"mod\":[1,5,7,8],\"weight\":0.449744,\"id\":9,\"text\":\"음반이자,\",\"label\":\"VNP\"},{\"head\":11,\"mod\":[],\"weight\":0.791354,\"id\":10,\"text\":\"이\",\"label\":\"DP\"},{\"head\":12,\"mod\":[10],\"weight\":0.777441,\"id\":11,\"text\":\"음반에\",\"label\":\"NP_AJT\"},{\"head\":14,\"mod\":[9,11],\"weight\":0.85099,\"id\":12,\"text\":\"수록된\",\"label\":\"VP_MOD\"},{\"head\":14,\"mod\":[],\"weight\":0.646044,\"id\":13,\"text\":\"타이틀\",\"label\":\"NP\"},{\"head\":-1,\"mod\":[12,13],\"weight\":8.72712E-4,\"id\":14,\"text\":\"송이다.\",\"label\":\"VNP\"}],\"ZA\":[],\"WSD\":[{\"scode\":\"00\",\"weight\":1,\"end\":0,\"id\":0,\"text\":\"《\",\"position\":0,\"type\":\"SS\",\"begin\":0},{\"scode\":\"00\",\"weight\":1,\"end\":1,\"id\":1,\"text\":\"Sweet\",\"position\":3,\"type\":\"SL\",\"begin\":1},{\"scode\":\"00\",\"weight\":1,\"end\":2,\"id\":2,\"text\":\"Dream\",\"position\":9,\"type\":\"SL\",\"begin\":2},{\"scode\":\"00\",\"weight\":1,\"end\":3,\"id\":3,\"text\":\"》\",\"position\":14,\"type\":\"SS\",\"begin\":3},{\"scode\":\"00\",\"weight\":1,\"end\":4,\"id\":4,\"text\":\"은\",\"position\":17,\"type\":\"JX\",\"begin\":4},{\"scode\":\"00\",\"weight\":0,\"end\":5,\"id\":5,\"text\":\"대한민국\",\"position\":21,\"type\":\"NNP\",\"begin\":5},{\"scode\":\"00\",\"weight\":1,\"end\":6,\"id\":6,\"text\":\"의\",\"position\":33,\"type\":\"JKG\",\"begin\":6},{\"scode\":\"01\",\"weight\":3.7,\"end\":7,\"id\":7,\"text\":\"여성\",\"position\":37,\"type\":\"NNG\",\"begin\":7},{\"scode\":\"11\",\"weight\":4.03333,\"end\":8,\"id\":8,\"text\":\"가수\",\"position\":44,\"type\":\"NNG\",\"begin\":8},{\"scode\":\"00\",\"weight\":0,\"end\":9,\"id\":9,\"text\":\"장나라\",\"position\":51,\"type\":\"NNP\",\"begin\":9},{\"scode\":\"00\",\"weight\":1,\"end\":10,\"id\":10,\"text\":\"의\",\"position\":60,\"type\":\"JKG\",\"begin\":10},{\"scode\":\"01\",\"weight\":3.2,\"end\":11,\"id\":11,\"text\":\"두\",\"position\":64,\"type\":\"MM\",\"begin\":11},{\"scode\":\"00\",\"weight\":0,\"end\":12,\"id\":12,\"text\":\"번째\",\"position\":68,\"type\":\"NNB\",\"begin\":12},{\"scode\":\"01\",\"weight\":3,\"end\":13,\"id\":13,\"text\":\"정규\",\"position\":75,\"type\":\"NNG\",\"begin\":13},{\"scode\":\"00\",\"weight\":0,\"end\":14,\"id\":14,\"text\":\"음반\",\"position\":82,\"type\":\"NNG\",\"begin\":14},{\"scode\":\"01\",\"weight\":1,\"end\":15,\"id\":15,\"text\":\"이\",\"position\":88,\"type\":\"VCP\",\"begin\":15},{\"scode\":\"00\",\"weight\":1,\"end\":16,\"id\":16,\"text\":\"자\",\"position\":91,\"type\":\"EC\",\"begin\":16},{\"scode\":\"00\",\"weight\":1,\"end\":17,\"id\":17,\"text\":\",\",\"position\":94,\"type\":\"SP\",\"begin\":17},{\"scode\":\"05\",\"weight\":5.2,\"end\":18,\"id\":18,\"text\":\"이\",\"position\":96,\"type\":\"MM\",\"begin\":18},{\"scode\":\"00\",\"weight\":0,\"end\":19,\"id\":19,\"text\":\"음반\",\"position\":100,\"type\":\"NNG\",\"begin\":19},{\"scode\":\"00\",\"weight\":1,\"end\":20,\"id\":20,\"text\":\"에\",\"position\":106,\"type\":\"JKB\",\"begin\":20},{\"scode\":\"02\",\"weight\":1,\"end\":22,\"id\":21,\"text\":\"수록되\",\"position\":110,\"type\":\"VV\",\"begin\":21},{\"scode\":\"00\",\"weight\":1,\"end\":23,\"id\":22,\"text\":\"ㄴ\",\"position\":116,\"type\":\"ETM\",\"begin\":23},{\"scode\":\"00\",\"weight\":0,\"end\":24,\"id\":23,\"text\":\"타이틀\",\"position\":120,\"type\":\"NNG\",\"begin\":24},{\"scode\":\"01\",\"weight\":1,\"end\":25,\"id\":24,\"text\":\"송이\",\"position\":130,\"type\":\"NNG\",\"begin\":25},{\"scode\":\"01\",\"weight\":1,\"end\":26,\"id\":25,\"text\":\"이\",\"position\":133,\"type\":\"VCP\",\"begin\":26},{\"scode\":\"00\",\"weight\":1,\"end\":27,\"id\":26,\"text\":\"다\",\"position\":136,\"type\":\"EF\",\"begin\":27},{\"scode\":\"00\",\"weight\":1,\"end\":28,\"id\":27,\"text\":\".\",\"position\":139,\"type\":\"SF\",\"begin\":28}],\"chunk\":[],\"reserve_str\":\"\",\"SRL\":[],\"morp_eval\":[{\"result\":\"《\\/SS+Sweet\\/SL\",\"word_id\":0,\"m_end\":1,\"id\":0,\"target\":\"《Sweet\",\"m_begin\":0},{\"result\":\"Dream\\/SL+》\\/SS+은\\/JX\",\"word_id\":1,\"m_end\":4,\"id\":1,\"target\":\"Dream》은\",\"m_begin\":2},{\"result\":\"대한민국\\/NNG+의\\/JKG\",\"word_id\":2,\"m_end\":6,\"id\":2,\"target\":\"대한민국의\",\"m_begin\":5},{\"result\":\"여성\\/NNG\",\"word_id\":3,\"m_end\":7,\"id\":3,\"target\":\"여성\",\"m_begin\":7},{\"result\":\"가수\\/NNG\",\"word_id\":4,\"m_end\":8,\"id\":4,\"target\":\"가수\",\"m_begin\":8},{\"result\":\"장나라\\/NNG+의\\/JKG\",\"word_id\":5,\"m_end\":10,\"id\":5,\"target\":\"장나라의\",\"m_begin\":9},{\"result\":\"두\\/MM\",\"word_id\":6,\"m_end\":11,\"id\":6,\"target\":\"두\",\"m_begin\":11},{\"result\":\"번째\\/NNB\",\"word_id\":7,\"m_end\":12,\"id\":7,\"target\":\"번째\",\"m_begin\":12},{\"result\":\"정규\\/NNG\",\"word_id\":8,\"m_end\":13,\"id\":8,\"target\":\"정규\",\"m_begin\":13},{\"result\":\"음반\\/NNG+이\\/VCP+자\\/EC+,\\/SP\",\"word_id\":9,\"m_end\":17,\"id\":9,\"target\":\"음반이자,\",\"m_begin\":14},{\"result\":\"이\\/MM\",\"word_id\":10,\"m_end\":18,\"id\":10,\"target\":\"이\",\"m_begin\":18},{\"result\":\"음반\\/NNG+에\\/JKB\",\"word_id\":11,\"m_end\":20,\"id\":11,\"target\":\"음반에\",\"m_begin\":19},{\"result\":\"수록되\\/VV+ㄴ\\/ETM\",\"word_id\":12,\"m_end\":23,\"id\":12,\"target\":\"수록된\",\"m_begin\":21},{\"result\":\"타이틀\\/NNG\",\"word_id\":13,\"m_end\":24,\"id\":13,\"target\":\"타이틀\",\"m_begin\":24},{\"result\":\"송이\\/NNG+이\\/VCP+다\\/EF+.\\/SF\",\"word_id\":14,\"m_end\":28,\"id\":14,\"target\":\"송이다.\",\"m_begin\":25}],\"SA\":[],\"relation\":[],\"morp\":[{\"lemma\":\"《\",\"weight\":1,\"id\":0,\"position\":0,\"type\":\"SS\"},{\"lemma\":\"Sweet\",\"weight\":1,\"id\":1,\"position\":3,\"type\":\"SL\"},{\"lemma\":\"Dream\",\"weight\":1,\"id\":2,\"position\":9,\"type\":\"SL\"},{\"lemma\":\"》\",\"weight\":1,\"id\":3,\"position\":14,\"type\":\"SS\"},{\"lemma\":\"은\",\"weight\":0.0128817,\"id\":4,\"position\":17,\"type\":\"JX\"},{\"lemma\":\"대한민국\",\"weight\":0.0447775,\"id\":5,\"position\":21,\"type\":\"NNP\"},{\"lemma\":\"의\",\"weight\":0.0987295,\"id\":6,\"position\":33,\"type\":\"JKG\"},{\"lemma\":\"여성\",\"weight\":0.871186,\"id\":7,\"position\":37,\"type\":\"NNG\"},{\"lemma\":\"가수\",\"weight\":0.9,\"id\":8,\"position\":44,\"type\":\"NNG\"},{\"lemma\":\"장나라\",\"weight\":0.15,\"id\":9,\"position\":51,\"type\":\"NNP\"},{\"lemma\":\"의\",\"weight\":0.0987295,\"id\":10,\"position\":60,\"type\":\"JKG\"},{\"lemma\":\"두\",\"weight\":0.014572,\"id\":11,\"position\":64,\"type\":\"MM\"},{\"lemma\":\"번째\",\"weight\":0.18051,\"id\":12,\"position\":68,\"type\":\"NNB\"},{\"lemma\":\"정규\",\"weight\":0.9,\"id\":13,\"position\":75,\"type\":\"NNG\"},{\"lemma\":\"음반\",\"weight\":0.9,\"id\":14,\"position\":82,\"type\":\"NNG\"},{\"lemma\":\"이\",\"weight\":0.0177525,\"id\":15,\"position\":88,\"type\":\"VCP\"},{\"lemma\":\"자\",\"weight\":0.109096,\"id\":16,\"position\":91,\"type\":\"EC\"},{\"lemma\":\",\",\"weight\":1,\"id\":17,\"position\":94,\"type\":\"SP\"},{\"lemma\":\"이\",\"weight\":0.0017249,\"id\":18,\"position\":96,\"type\":\"MM\"},{\"lemma\":\"음반\",\"weight\":0.9,\"id\":19,\"position\":100,\"type\":\"NNG\"},{\"lemma\":\"에\",\"weight\":0.153364,\"id\":20,\"position\":106,\"type\":\"JKB\"},{\"lemma\":\"수록\",\"weight\":0.205116,\"id\":21,\"position\":110,\"type\":\"NNG\"},{\"lemma\":\"되\",\"weight\":2.24177E-4,\"id\":22,\"position\":116,\"type\":\"XSV\"},{\"lemma\":\"ㄴ\",\"weight\":0.392321,\"id\":23,\"position\":116,\"type\":\"ETM\"},{\"lemma\":\"타이틀\",\"weight\":0.9,\"id\":24,\"position\":120,\"type\":\"NNG\"},{\"lemma\":\"송이\",\"weight\":0.17899,\"id\":25,\"position\":130,\"type\":\"NNG\"},{\"lemma\":\"이\",\"weight\":0.0177525,\"id\":26,\"position\":133,\"type\":\"VCP\"},{\"lemma\":\"다\",\"weight\":0.353579,\"id\":27,\"position\":136,\"type\":\"EF\"},{\"lemma\":\".\",\"weight\":1,\"id\":28,\"position\":139,\"type\":\"SF\"}],\"NE\":[{\"weight\":0.993015,\"end\":2,\"id\":0,\"text\":\"Sweet Dream\",\"type\":\"AFW_MUSIC\",\"begin\":1,\"common_noun\":0},{\"weight\":0.476586,\"end\":5,\"id\":1,\"text\":\"대한민국\",\"type\":\"LCP_COUNTRY\",\"begin\":5,\"common_noun\":0},{\"weight\":0.456079,\"end\":8,\"id\":2,\"text\":\"가수\",\"type\":\"CV_OCCUPATION\",\"begin\":8,\"common_noun\":0},{\"weight\":0.91749,\"end\":9,\"id\":3,\"text\":\"장나라\",\"type\":\"PS_NAME\",\"begin\":9,\"common_noun\":0},{\"weight\":0.89522,\"end\":12,\"id\":4,\"text\":\"두 번째\",\"type\":\"QT_ORDER\",\"begin\":11,\"common_noun\":0}],\"id\":0,\"text\":\"《Sweet Dream》은 대한민국의 여성 가수 장나라의 두 번째 정규 음반이자, 이 음반에 수록된 타이틀 송이다.\",\"word\":[{\"end\":1,\"id\":0,\"text\":\"《Sweet\",\"type\":\"\",\"begin\":0},{\"end\":4,\"id\":1,\"text\":\"Dream》은\",\"type\":\"\",\"begin\":2},{\"end\":6,\"id\":2,\"text\":\"대한민국의\",\"type\":\"\",\"begin\":5},{\"end\":7,\"id\":3,\"text\":\"여성\",\"type\":\"\",\"begin\":7},{\"end\":8,\"id\":4,\"text\":\"가수\",\"type\":\"\",\"begin\":8},{\"end\":10,\"id\":5,\"text\":\"장나라의\",\"type\":\"\",\"begin\":9},{\"end\":11,\"id\":6,\"text\":\"두\",\"type\":\"\",\"begin\":11},{\"end\":12,\"id\":7,\"text\":\"번째\",\"type\":\"\",\"begin\":12},{\"end\":13,\"id\":8,\"text\":\"정규\",\"type\":\"\",\"begin\":13},{\"end\":17,\"id\":9,\"text\":\"음반이자,\",\"type\":\"\",\"begin\":14},{\"end\":18,\"id\":10,\"text\":\"이\",\"type\":\"\",\"begin\":18},{\"end\":20,\"id\":11,\"text\":\"음반에\",\"type\":\"\",\"begin\":19},{\"end\":23,\"id\":12,\"text\":\"수록된\",\"type\":\"\",\"begin\":21},{\"end\":24,\"id\":13,\"text\":\"타이틀\",\"type\":\"\",\"begin\":24},{\"end\":28,\"id\":14,\"text\":\"송이다.\",\"type\":\"\",\"begin\":25}]},\"subject\":{\"text\":\"장나라\",\"type\":\"PS_NAME\",\"byteEnd\":60,\"byteBegin\":51},\"object\":{\"text\":\"대한민국\",\"type\":\"LCP_COUNTRY\",\"byteEnd\":33,\"byteBegin\":21}}");
        JSONObject sentence = (JSONObject) instance.get("sentence");
        JSONObject subject = (JSONObject) instance.get("subject");
        JSONObject object = (JSONObject) instance.get("object");

        for (DependencyPattern dp : DPFactory.generate(sentence, subject, object)) {
            System.out.println(dp);
        }
    }

    @Test
    public void testGenerateAll() throws IOException, InterruptedException {
        Configuration.NUMBER_OF_THREADS = 4;
        Configuration.MODEL_ROOT = "data/test/models";

        DPFactory.generateAll();
    }

    @Test
    public void testAnnotateAll() throws IOException, InterruptedException {
        Configuration.NUMBER_OF_THREADS = 4;
        Configuration.MODEL_ROOT = "data/test/models";

        DPFactory.annotateAll();
    }

}
